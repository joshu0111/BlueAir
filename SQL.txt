1) Récupérer le fichier de création de tables AVION, PILOTE, CLIENT et VOL sur le cours en ligne.
Y ajouter les clés primaires. 

ALTER TABLE avion
  ADD CONSTRAINT pk_avion PRIMARY KEY (NumAv);

ALTER TABLE pilote
  ADD CONSTRAINT pk_pilote PRIMARY KEY (NumPil);

ALTER TABLE client
  ADD CONSTRAINT pk_client PRIMARY KEY (NumCl);

ALTER TABLE vol
  ADD CONSTRAINT pk_vol PRIMARY KEY (NumVol);

2) Créer les tables CLASSE et RESERVATION avec leurs clés primaires. 

CREATE TABLE classe (
    NumVol VARCHAR(5),
    NomClasse VARCHAR2(15),
    CoeffPlace NUMBER(4,3),
    CoeffPrix NUMBER(3,1),
    CONSTRAINT pk_classe PRIMARY KEY (NumVol, NomClasse)
);

CREATE TABLE reservation (
    NumCl NUMBER(5),
    NumVol VARCHAR(5),
    NomClasse VARCHAR2(15),
    NbPlaces NUMBER(3),
    CONSTRAINT CPRV PRIMARY KEY (NumCl, NumVol, NomClasse)
);


3) Ajouter les clés étrangères à toutes les tables à l’aide de requêtes ALTER TABLE et nommer les
contraintes. 

ALTER TABLE vol
ADD CONSTRAINT VFKA
FOREIGN KEY (NumAv) 
REFERENCES avion(NumAv);

ALTER TABLE vol
ADD CONSTRAINT VFKP 
FOREIGN KEY (NumPil) 
REFERENCES pilote(NumPil);

ALTER TABLE classe
ADD CONSTRAINT CFKV
FOREIGN KEY (NumVol) 
REFERENCES vol(NumVol);

ALTER TABLE reservation
ADD CONSTRAINT RFKV 
FOREIGN KEY (NumVol) 
REFERENCES vol(NumVol);

ALTER TABLE reservation
ADD CONSTRAINT RFKC
FOREIGN KEY (NumVol, NomClasse) 
REFERENCES classe(NumVol, NomClasse);

ALTER TABLE reservation
ADD CONSTRAINT RFKCl
FOREIGN KEY (NumCl) 
REFERENCES client(NumCl);


4) Insérer les données à partir du fichier disponible sur le cours en ligne dans les tables : AVION,
PILOTE, CLIENT, VOL. 
5) Pour la table CLASSE et le vol V9000 :
-Créer une classe « AFF » qui portera sur 40% des places et qui coûtera 2 fois plus cher que
la classe ECO.
-Créer une classe « TOUR » qui portera sur 40% des places et qui coûtera 1,5 fois plus cher
que la classe ECO.
-Créer une classe ECO qui portera sur les places restantes. 

insert into classe (NumVol, NomClasse, CoeffPlace, CoeffPrix)
values ('V9000', 'AFF', 0.400, 2.0);

insert into classe (NumVol, NomClasse, CoeffPlace, CoeffPrix)
values ('V9000', 'TOUR', 0.400, 1.5);

insert into classe (NumVol, NomClasse, CoeffPlace, CoeffPrix)
values ('V9000', 'ECO', 0.200, 1);

6)
6 Pour la table CLASSE et les autres vols :
Créer les classes suivantes pour chacun des autres vols en respectant :
- Toujours une classe ECO (20% des places).
- Une classe TOUR pour les vols V8000, V8D90, V327B, V0702 (60% des places)
- Une classe AFF pour les vols V327B (20 %). 

insert into classe (
NumVol, NomClasse, CoeffPlace, CoeffPrix)
select NumVol, 'ECO', 0.200,1 from vol where NumVol !='V9000';

insert into classe (NumVol, NomClasse, CoeffPlace, CoeffPrix)
select NumVol, 'TOUR', 0.600,1.5 from vol where NumVol='V8000'
or NumVol='V8D90' or NumVol='V327B' or NumVol='V0702';

insert into classe (NumVol, NomClasse, CoeffPlace, CoeffPrix)
values ('V327B', 'AFF', 0.200, 2);

7) Charger les données dans la table RESERVATION. 

Partie 2 :

8) Afficher tous les avions de la compagnie (numéros, modèles et capacités). 

select NumAv, ModAv, CapAv from avion;

9) Afficher le nombre d’avions total et le nombre d’avions différents. 
pour le nombre d'avions total : select count(*) from avion;
pour le nombre d'avion differents : select count(distinct ModAv) from avion; 

10) Afficher le coût moyen d’un vol arrondi au centième.

select round(AVG(coutvol), 2) from vol;

11) Afficher le coût moyen des vols au départ de chaque ville arrondi au centième. 

select villed, round(AVG(coutvol), 2) from vol group by villed;

12) Afficher les numéros des vols, la destination et l’heure de départ des vols en partance de
Marseille. 

SELECT numvol, villea, to_char(dated, 'hh24:mi') from VOL where villed = 'Marseille';


13)  Afficher le numéro et le modèle des avions dont le nom du modèle ne contient pas la lettre A/a.

select numav, modav from avion where not modav like 'A%' or not  modav like 'a%';


14) Trier les vols au départ de Marseille, par ordre croissant sur les dates de départ

select * from vol where villed='Marseille' order by dated;

15) Afficher le numéro de vol, le modèle de l'avion, la ville d’arrivée, la date et l’heure de départ. 

select numvol, modav, villed, dated, to_char(dated, 'hh24:mi') from vol 
join avion on vol.numav=avion.numav; 

16) Afficher le nombre de villes desservies par la compagnie.
select count(villed) from vol

17) Afficher le nombre de places réservées sur le vol V9000. 

select sum(nbplaces) from reservation where numvol='V9000'

18) Afficher le nombre de réservation par client (nom client)

select client.nomcl,count(reservation.numcl) from client inner join reservation on reservation.numcl=client.numcl group by nomcl


19) Afficher les numéros et noms des clients ayant effectué au moins 2 réservations. $

select client.numcl, nomcl from reservation inner join client on reservation.numcl=client.numcl group by client.numcl, nomcl having count(*)>=2;

20) Numéros et noms des pilotes qui n’effectuent aucun vol.

select numpil, nompil from pilote where numpil not in (select numpil from vol)

21) Numéros et noms de chaque pilote et nombre d’avions qu’il pilote.

select vol.numpil, nompil, count(numvol) from pilote inner join vol on pilote.numpil=vol.numpil group by vol.numpil, nompil ;

22) Donner le temps de vol total par pilote, exprimé en heures arrondies au centième

23) Quel est le nom du pilote le plus expérimenté ? 

select pilote.NomPil from vol inner join pilote on pilote.NumPil = vol.NumPil group by pilote.NomPil 
having sum((vol.DateA-vol.DateD)*24) = (select max(sum((vol.DateA-vol.DateD)*24)) from vol group by vol.NumPil);

24) Noms des pilotes qui effectuent le plus de vols. 

select vol.numpil, nompil, count(numvol) from pilote inner join vol on pilote.numpil=vol.numpil having count(numvol)> 1 
group by vol.numpil, nompil order by count(numvol) desc;






